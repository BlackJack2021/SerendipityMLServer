# 概要

## 本ディレクトリの目的

暗黙的な評価値に基づく行列分解である **Implicit Matrix Factorization(IMF)** を実装する。

## 使い方

### 学習

`poetry shell` で仮想環境を立ち上げた上で、`python3 -m srd.recommend.ml.imf.train` と打ち込んで `train.py` スクリプトを実行することで、学習から評価まで一貫して行ってくれる。

## アルゴリズムの概要

暗黙的な評価値とは、商品詳細ページのクリックや動画の視聴などのユーザーが明示的に評価したわけではないユーザーの行動履歴のこと。

ユーザー $u$ のアイテム $i$ に対する好意を示す 2 値変数 $\bar{r}_{ui}$ を定義する。これは $r_{ui}$ を一度でも閲覧したか否かで二値化したフラグであり、以下のように定義される。

$$
\begin{align*}
\bar{r}_{ui} = \begin{cases}
1 & (r_{ui} >0) \\
0 & (r_{ui} = 0)
\end{cases}
\end{align*}
$$

この表現はユーザー $u$ がアイテム $i$ を一度でも閲覧していたら、ユーザー $u$ はアイテム $i$ に対して好意を持っていることを意味する。

しかしユーザーによってはあるアイテムを複数回クリックしていることもあり、この場合は単に一度クリックされた場合よりも信頼できる数値であると考えることが自然である。この仮説を基に好意に対する **信頼度** を定義する。つまりその好意をどれだけ信頼してよいかを示すものであり、これは $r_{ui}$ (閲覧回数)に比例する形で表現されると仮定する。つまり $c_{u,i}$ は以下のように $r_{u,i}$ に $\alpha$ という定数をかけて、1 を足したものになる。

$$
\begin{align*}
c_{ui} = 1 + \alpha r_{ui}
\end{align*}
$$

閲覧されていない理由には、好きでない以外にも、知らなかったなどの理由が考えられるため、信頼度は低くなる。このように観測値 $r_{ui}$ を好意 $\bar{r}_{ui}$ とその好意の信頼度 $c_{ui}$ に分解することが、暗黙的な評価における行列分解の基礎的な考え方になる。

行列分解の最適化の式は以下のようになる。

$$
\begin{align*}
\min_{p, q} = \sum_{u}^{N} \sum_{i}^{M}c_{ui}(\bar{r}_{ui} - p_u^T q_i)^2 + \lambda \biggl( \sum_{u}||p_u||^2 + \sum_{i} ||q_i||^2 \biggr)
\end{align*}
$$

観測値行列をユーザー因子行列とアイテム因子行列に分解しているのは明示的な評価の行列分解と同様だが、次の２点が異なる。

1. IMF の式ではユーザーとアイテムのすべての組み合わせ（つまり観測されていない評価値も含めているということ）で総和を取っている。
   - これは暗黙的な評価には負例がないことに起因しており、観測されていないものを負例とみなすことで学習していることを意味。
2. 信頼度 $c_{ui}$ が重みとして入っている。
   - たくさん閲覧されている場合は $c_{ui}$ が大きくなり、$r_{ui} = 1$ であることに注意すれば、$p_u q_i^T$ がより 1 に近くなるように学習されることが分かる。
